---
description: 睡眠记录功能 - 追踪宝宝的入睡和睡醒时间
globs:
  - "src/components/forms/SleepEndForm.tsx"
  - "src/app/page.tsx"
alwaysApply: false
---

# 睡眠记录

追踪宝宝的睡眠模式，包括入睡时间、睡醒时间和睡眠时长。

## Core Components

**数据模型:**
- `Activity` - type: `SLEEP_START` | `SLEEP_END`
- `sleepStartId` - 关联入睡记录（用于计算时长，仅 SLEEP_END）
- `duration` - 睡眠时长（分钟，补录时使用）

**组件:**
- `SleepEndForm` - 睡醒表单，支持自动计算或手动输入时长
- `ActivityButton` - 入睡/睡醒按钮
- `TimeAdjuster` - 时间滑块+微调组件
- `SliderInput` - 通用滑块输入组件（用于补录时长）

## How It Works

### 标准流程（先入睡后睡醒）
1. 用户点击"入睡"按钮，记录 `SLEEP_START`
2. "入睡"按钮变为禁用状态
3. 用户点击"睡醒"按钮
4. 系统自动获取入睡时间，计算睡眠时长
5. 显示睡眠时长，支持微调（-1小时/-15分/-5分/+1分）
6. 记录 `SLEEP_END`，关联 `sleepStartId`

### 补录流程（直接点睡醒）
1. 用户直接点击"睡醒"按钮（没有先点入睡）
2. `SleepEndForm` 显示时长滑块（15-240分钟，15分钟间隔）
3. 用户拖动滑块选择睡眠时长
4. 可用微调按钮细调（±15分钟/±75分钟）
5. 记录 `SLEEP_END`，`duration` 为用户选择的时长

### 时间选择器（TimeAdjuster）
- **滑块**: 范围从"1小时前"到"现在"，5分钟间隔
- **微调按钮**: -1小时、-15分钟、-5分钟、+1分钟
- **不显示日期**: 只显示时间（HH:mm格式）
- 不允许超过当前时间

### 状态管理
- `sleepState` 追踪当前状态：`'start'` | `'end'`
- 使用 `useSleepState()` hook 获取状态
- 当宝宝已入睡时，"入睡"按钮 disabled

## Key Files
- `src/components/forms/SleepEndForm.tsx` - 睡醒表单组件
- `src/components/TimeAdjuster.tsx` - 时间滑块+微调组件
- `src/components/SliderInput.tsx` - 通用滑块输入组件
- `src/lib/api/hooks.ts` - useSleepState hook
- `src/app/page.tsx` - 主页面
- `prisma/schema.prisma` - Activity 模型定义

## UI 设计要点
- 字体加大：时间显示 `text-5xl`，时长显示 `text-5xl`
- 滑块范围：1小时前 ~ 现在，5分钟间隔
- 微调按钮：4列布局，颜色区分（减少=蓝色，增加=绿色）
- 补录时长：滑块输入（15-240分钟，15分钟间隔）

## Future Improvements
- 睡眠质量评估（好/一般/差）
- 睡眠统计图表（每日/每周睡眠时长）
- 睡眠提醒（设定目标睡眠时长）
