// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

// 活动类型枚举 - 保留旧类型用于向后兼容
enum ActivityType {
  // 单条记录类型
  SLEEP            // 睡眠（单条记录：recordTime=入睡时间，duration=睡眠时长，duration为null表示正在睡）
  DIAPER           // 换尿布
  BREASTFEED       // 亲喂（单条记录包含开始时间和时长）
  BOTTLE           // 瓶喂（单条记录包含开始时间、时长和奶量）
  // 旧的配对类型（保留用于向后兼容）
  SLEEP_START      // 入睡 (deprecated, 使用 SLEEP 替代)
  SLEEP_END        // 睡醒 (deprecated, 使用 SLEEP 替代)
  BREASTFEED_START // 开始亲喂 (deprecated)
  BREASTFEED_END   // 结束亲喂 (deprecated)
  BOTTLE_START     // 开始瓶喂 (deprecated)
  BOTTLE_END       // 结束瓶喂 (deprecated)
  // 其他活动
  HEAD_LIFT        // 抬头
  PASSIVE_EXERCISE // 被动操
  GAS_EXERCISE     // 排气操
  BATH             // 洗澡
  OUTDOOR          // 户外晒太阳
  EARLY_EDUCATION  // 早教
}

// 大便颜色枚举
enum PoopColor {
  YELLOW       // 黄色
  GREEN        // 绿色
  BROWN        // 棕色
  BLACK        // 黑色
  WHITE        // 白色
  RED          // 红色（需要注意）
}

// 小便量枚举
enum PeeAmount {
  SMALL   // 少
  MEDIUM  // 中
  LARGE   // 多
}

// 宝宝资料模型（单例，只存储一个宝宝的信息）
model BabyProfile {
  id        String   @id @default("default")
  name      String?  // 宝宝名字
  avatarUrl String?  // 头像URL（存储在Vercel Blob）
  birthDate DateTime? // 出生日期
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// 活动记录模型
model Activity {
  id              String       @id @default(cuid())
  type            ActivityType
  recordTime      DateTime     @default(now()) // 活动开始时间
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  // 尿布相关字段
  hasPoop         Boolean?     // 是否有大便
  hasPee          Boolean?     // 是否有小便
  poopColor       PoopColor?   // 大便颜色
  poopPhotoUrl    String?      // 大便照片URL（存储在Vercel Blob）
  peeAmount       PeeAmount?   // 小便量

  // 喂奶/活动相关字段
  burpSuccess     Boolean?     // 拍嗝是否成功
  duration        Int?         // 持续时间（分钟）
  milkAmount      Int?         // 奶量（毫升）- 瓶喂专用

  // 关联字段（用于向后兼容旧的配对记录）
  startActivityId String?      @unique
  startActivity   Activity?    @relation("ActivityPair", fields: [startActivityId], references: [id])
  endActivity     Activity?    @relation("ActivityPair")

  // 备注
  notes           String?

  @@index([type])
  @@index([recordTime])
  @@index([createdAt])
}
